---
layout: post
title: Automating software installs
date: '2013-10-29T02:57:00.002-07:00'
author: Gert Lombard
tags:
- scripting
- automation
modified_time: '2013-10-30T03:23:40.428-07:00'
blogger_id: tag:blogger.com,1999:blog-1583243090910089198.post-3153715793361460753
blogger_orig_url: http://www.lombard.me/2013/10/automating-software-installs.html
---

This is my favourite software development topic: automating installs.<br /><br />I'm a lazy programmer, in the sense that Larry Wall talks about when he says <a href="http://c2.com/cgi/wiki?LazinessImpatienceHubris">laziness is one the three great virtues</a> of a programmer: that means I hate doing things manually over and over again. I'd rather spend an hour writing a script to download and install a utility, then doing it manually many times on multiple machines. Automating the installation of tools also has some other benefits: (a) it ensures the consistent replication of environments and (b) it serves as documentation of exactly what was done for future reference.<br /><br />Nowadays I make a lot of use of virtual machines (mostly using Hyper-V recently) for my development on Windows. This allows me to easily delete VMs and start over as often as I like. It also means I can keep my development environments separate: e.g. one VM for Java/Eclipse, one for an older version of Visual Studio, one for playing with Ubuntu, etc.<br /><br />When you install a lot of development environments over and over, you need to be aware of the different tools available to help automate things. In the Linux world, automated/unattended installs are the norm (using things like apt-get), but in Windows it takes a bit more effort to automate the installation of applications.<br /><br />Here's a few ideas for installing utilities/tools from the command-line (i.e. from scripts):<br /><ul><li><a href="http://chocolatey.org/">Chocolatey </a>- very cool tool to install lots of popular applications with a simple command like:&nbsp;<span style="font-family: Courier New, Courier, monospace;">cinst notepadplusplus</span></li><li><a href="http://ninite.com/">Ninite</a> - Pick the applications you want to install and it generates a single installer to package them all.</li><li><a href="http://technet.microsoft.com/en-us/library/dd744566(v=ws.10).aspx">DISM.exe</a> - a Windows tool to Enable/Disable Windows Features from the command-line. Use this to enable things like IIS or Hyper-V from a script.</li><li><a href="http://msdn.microsoft.com/en-us/library/windowsazure/gg433092.aspx">WebPICmd.exe</a> - <a href="http://www.microsoft.com/web/downloads/platform.aspx">Microsoft Web Platform Installer</a> - install certain products like SQL Server Express from the command-line.</li><li>In some cases it's easy enough to just write your own customer silent installer for a product. A lot of applications use InstallShield or other well-known installers and a lot of them behave the same way, so it's usually possible to figure out which command-line parameters to pass to the installer to do an unattend/silent install.</li></ul>In addition to the above tools, you obviously need to be comfortable writing scripts of some sort. In the old days, I used to use Perl for all of my scripting needs. In recent years I've done more plain Batch files and some PowerShell. PowerShell is great because it's so ubiquitous on Windows systems, but it does have a steep learning curve in my opinion. I'm currently trying Python as my primary scripting language instead of plain old Batch files.<br /><br /><b>Using Chocolatey:</b><br /><br />As an example of using Chocolatey on Windows, let's install the first two tools every developer needs on their machine: <a href="http://curl.haxx.se/docs/manpage.html">cURL</a> and the <a href="http://www.7-zip.org/">7-Zip</a> Command Line tool for extracting archives from the command-line:<br /><br />First, install Chocolatey itself (requires .NET Framework 4.0 to be installed) and then we use cinst to install curl and 7za:<br /><pre><code>C:\&gt; powershell -NoProfile -ExecutionPolicy unrestricted -Command "iex ((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1'))" &amp;&amp; SET PATH=%PATH%;%systemdrive%\chocolatey\bin<br />C:\&gt;<br />C:\&gt; cinst 7zip.commandline<br />C:\&gt; cinst curl<br /></code></pre>And that's it!<br /><br /> <b>Using Web Platform Installer (webpicmd):</b><br /><br />Let's install webpicmd with Chocolatey and then we'll install IIS Express using webpicmd: <pre><code>C:\&gt; cinst webpicmd<br /></code></pre>Now list all packages matching "IIS": <pre><code>C:\&gt; webpicmd /List /ListOption:Available | findstr "IIS"<br /></code></pre>From the above we see that we're looking for the package called just "IISExpress", so install it: <pre><code>C:\&gt; webpicmd /Install /Products:IISExpress /AcceptEula<br /></code></pre> <b>Using PowerShell to install utilities:</b><br /><br />Now, for contrast, let's say you've got a clean Windows 7 machine and Chocolatey won't work yet (because the .NET framework ins't installed), then it's easy enough to roll your own automated installs of 7-Zip and cURL using PowerShell. Once we have 7za and curl, this bootstraps everything: next we can easily script the download and install .NET Framework and Chocolatey...<br /><br />To download 7-Zip command-line version (7za) and extract it using PowerShell:<br /><pre><code>function Unzip-File<br />{<br />    param ([string]$zipFile, [string]$destFolder)<br />    New-Item -ItemType Directory -Force -Path $destFolder<br />    $shell = New-Object -Com Shell.Application<br />    $zip = $shell.NameSpace($zipFile)<br />    $shell.NameSpace($destFolder).CopyHere($zip.Items(), 16)<br />}<br /><br />Write-Host "Installing 7-Zip Command Line (7za)..."<br />$dest = "$env:ProgramFiles\7-Zip"<br />$destFile = "$env:ProgramFiles\7-Zip\7za.exe"<br />if (!(Test-Path $destFile))<br />{<br />    Write-Host "Downloading 7za..."<br />    $wc = New-Object Net.WebClient<br />    $url = 'http://downloads.sourceforge.net/sevenzip/7za920.zip'<br />    $file = "$env:TEMP\7za920.zip"<br />    $wc.DownloadFile($url,$file)<br />    Write-Host "Unzipping to: $dest"<br />    Unzip-File $file $dest<br />    Remove-Item $file<br />}<br />else<br />{<br />    Write-Host "7za already installed."<br />}<br /></code></pre>Next, let's download cURL and copy it into the Windows directory (because it's a single file and then it's already in the PATH for easy use):<br /><pre><code>function Unzip-File<br />{<br />    param ([string]$zipFile, [string]$destFolder)<br />    <br />    $7z = "$env:ProgramFiles\7-Zip\7za.exe"<br />    if (Test-Path $7z)<br />    {<br />        $info = New-Object Diagnostics.ProcessStartInfo<br />        $info.FileName = $7z<br />        $info.Arguments = "x -y -o""$destFolder"" ""$zipFile"""<br />        $info.Verb = "runas"<br />        $proc = [Diagnostics.Process]::Start($info)<br />        $proc.WaitForExit()<br />    }<br />    else<br />    {<br />        $shell = New-Object -Com Shell.Application<br />        $zip = $shell.NameSpace($zipFile)<br />        $shell.NameSpace($destFolder).CopyHere($zip.Items(), 16)<br />    }<br />}<br /><br />Write-Host "Installing cURL..."<br />$wc = New-Object Net.WebClient<br />$url = "http://www.paehl.com/open_source/?download=curl_732_0_ssl.zip"<br />$file = "$env:TEMP\curl.zip"<br />$wc.DownloadFile($url,$file)<br />Write-Host "Unzipping to: $env:windir"<br />Unzip-File $file $env:windir<br />Remove-Item $file<br /></code></pre>Now download the .NET Framework 4.5.1 using cURL (of course you can download it with PowerShell as well, but I like to use cURL):<br /><pre><code>C:\temp&gt; curl -L http://go.microsoft.com/fwlink/?LinkId=322116 -o c:\temp\NDP451-KB2858728-x86-x64-AllOS-ENU.exe<br />C:\temp&gt; NDP451-KB2858728-x86-x64-AllOS-ENU /q<br /></code></pre>Resources:<br /><ul><li><a href="http://unattended.sourceforge.net/installers.php">Instructions for how to silently install MSI and InstallShield installers</a></li><li><a href="http://wpkg.org/Category:Silent_Installers">WPKG Silent Installers List</a>&nbsp;- lots of examples of the silent install parameters for lots of popular applications.</li></ul>